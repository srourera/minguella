<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>Admin Multas — Privado</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        margin: 24px;
        background: #fafafa;
        color: #222;
      }
      h1 {
        margin: 0 0 12px;
        text-align: center;
        color: #2c3e50;
      }
      .muted {
        color: #666;
      }
      .step-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      /* Responsive para móviles */
      @media (max-width: 768px) {
        body {
          margin: 12px;
        }
        
        .step-container {
          padding: 16px;
          border-radius: 8px;
        }
        
        .step-title {
          font-size: 20px;
          margin-bottom: 16px;
        }
        
        h1 {
          font-size: 24px;
          margin-bottom: 16px;
        }
      }
      .step {
        display: none;
        animation: fadeIn 0.3s ease-in;
      }
      .step.active {
        display: block;
      }
      .step-title {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
        text-align: center;
      }
      .players-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      @media (max-width: 768px) {
        .players-grid {
          grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
          gap: 12px;
          margin-bottom: 20px;
        }
      }
      .player-card {
        text-align: center;
        cursor: pointer;
        padding: 12px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      @media (max-width: 768px) {
        .player-card {
          padding: 8px;
        }
      }
      .player-card:hover {
        border-color: #3498db;
        transform: translateY(-2px);
      }
      .player-card.selected {
        border-color: #27ae60;
        background: #e8f5e8;
      }
      .player-photo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 8px;
        border: 3px solid #e1e8ed;
      }

      @media (max-width: 768px) {
        .player-photo {
          width: 60px;
          height: 60px;
          margin-bottom: 6px;
        }
      }
      .player-name {
        font-size: 14px;
        font-weight: 500;
      }
      .fine-types-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      @media (max-width: 768px) {
        .fine-types-grid {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: 12px;
          margin-bottom: 20px;
        }
      }
      .player-name {
        font-size: 14px;
        font-weight: 500;
      }

      @media (max-width: 768px) {
        .player-name {
          font-size: 12px;
        }
      }

      .fine-type-card {
        text-align: center;
        cursor: pointer;
        padding: 16px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      @media (max-width: 768px) {
        .fine-type-card {
          padding: 12px;
        }
      }
      .fine-type-card:hover {
        border-color: #3498db;
        transform: translateY(-2px);
      }
      .fine-type-card.selected {
        border-color: #27ae60;
        background: #e8f5e8;
      }
      .fine-type-name {
        font-weight: 600;
        margin-bottom: 8px;
      }
      .fine-type-price {
        color: #e74c3c;
        font-weight: 600;
      }
      .amounts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      @media (max-width: 768px) {
        .amounts-grid {
          grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
          gap: 12px;
          margin-bottom: 20px;
        }
      }
      .amount-card {
        text-align: center;
        cursor: pointer;
        padding: 16px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      @media (max-width: 768px) {
        .amount-card {
          padding: 12px;
        }
      }
      .amount-card:hover {
        border-color: #3498db;
        transform: translateY(-2px);
      }
      .amount-card.selected {
        border-color: #27ae60;
        background: #e8f5e8;
      }
      .amount-value {
        font-size: 20px;
        font-weight: 700;
        color: #e74c3c;
      }

      @media (max-width: 768px) {
        .amount-value {
          font-size: 18px;
        }
      }
      .comments-section {
        margin-top: 24px;
      }
      .comments-input {
        width: 100%;
        min-height: 100px;
        padding: 12px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        font-family: inherit;
        resize: vertical;
        margin-bottom: 16px;
      }

      @media (max-width: 768px) {
        .comments-input {
          min-height: 80px;
          padding: 10px;
          margin-bottom: 12px;
        }
      }
      .save-button {
        background: #27ae60;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
        width: 100%;
      }

      @media (max-width: 768px) {
        .save-button {
          padding: 14px 20px;
          font-size: 16px;
        }
      }
      .save-button:hover {
        background: #229954;
      }
      .save-button:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
      }
      .navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 24px;
      }

      @media (max-width: 768px) {
        .navigation {
          margin-top: 20px;
          gap: 12px;
        }
      }
      .nav-button {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      @media (max-width: 768px) {
        .nav-button {
          padding: 12px 16px;
          font-size: 14px;
          flex: 1;
        }
      }
      .nav-button:hover {
        background: #2980b9;
      }
      .nav-button:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
      }
      .progress-bar {
        width: 100%;
        height: 6px;
        background: #e1e8ed;
        border-radius: 3px;
        margin-bottom: 24px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: #27ae60;
        transition: width 0.3s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <h1>Gestión de Multas</h1>

      <div class="step-container">
        <!-- Progress Bar -->
        <div class="progress-bar">
          <div class="progress-fill" :style="{ width: progress + '%' }"></div>
        </div>

        <!-- Step 1: Selección de Jugador -->
        <div class="step" :class="{ active: currentStep === 1 }">
          <div class="step-title">Selecciona un Jugador</div>
          <div class="players-grid">
            <div
              v-for="player in players"
              :key="player.id"
              class="player-card"
              :class="{ selected: selectedPlayer && selectedPlayer.id === player.id }"
              @click="selectPlayerAndNext(player)"
            >
              <img
                :src="player.photo"
                :alt="player.name"
                class="player-photo"
              />
              <div class="player-name">{{ player.name }}</div>
            </div>
          </div>
        </div>

                <!-- Step 2: Tipo de Multa -->
        <div class="step" :class="{ active: currentStep === 2 }">
          <div class="step-title">Tipo de Multa</div>
          <div class="fine-types-grid">
            <div 
              v-for="fineType in fineTypes" 
              :key="fineType.id"
              class="fine-type-card"
              :class="{ selected: selectedFineType && selectedFineType.id === fineType.id }"
              @click="selectFineTypeAndNext(fineType)"
            >
              <div class="fine-type-name">{{ fineType.name }}</div>
            </div>
          </div>
        </div>

                <!-- Step 3: Importe -->
        <div class="step" :class="{ active: currentStep === 3 }">
          <div class="step-title">Importe</div>
          <div class="amounts-grid">
            <div 
              v-for="amount in availableAmounts" 
              :key="amount"
              class="amount-card"
              :class="{ selected: selectedAmount === amount }"
              @click="selectAmountAndNext(amount)"
            >
              <div class="amount-value">{{ amount }}€</div>
            </div>
          </div>
        </div>

        <!-- Step 4: Comentarios y Guardar -->
        <div class="step" :class="{ active: currentStep === 4 }">
          <div class="step-title">Resumen y Comentarios</div>

          <div
            style="
              background: #f8f9fa;
              padding: 16px;
              border-radius: 8px;
              margin-bottom: 20px;
            "
          >
            <h4>Resumen de la Multa:</h4>
            <p><strong>Jugador:</strong> {{ selectedPlayer?.name }}</p>
            <p><strong>Tipo:</strong> {{ selectedFineType?.name }}</p>
            <p><strong>Importe:</strong> {{ selectedAmount }}€</p>
          </div>

          <div class="comments-section">
            <label for="comments">Comentarios (opcional):</label>
            <textarea
              id="comments"
              v-model="comments"
              class="comments-input"
              placeholder="Añade cualquier comentario adicional sobre la multa..."
            ></textarea>

            <button class="save-button" @click="saveFine" :disabled="saving">
              {{ saving ? 'Guardando...' : 'Guardar Multa' }}
            </button>
          </div>

          <div class="navigation">
            <button class="nav-button" @click="previousStep">Anterior</button>
          </div>
        </div>

        <!-- Botones de navegación para los primeros 3 pasos -->
        <div class="navigation" v-if="currentStep < 4">
          <button 
            class="nav-button" 
            @click="previousStep"
            :disabled="currentStep === 1"
          >
            Anterior
          </button>
          <button 
            class="nav-button" 
            @click="nextStep"
            :disabled="currentStep === 3"
          >
            Siguiente
          </button>
        </div>
        </div>
      </div>

      <p
        id="msg"
        class="muted"
        style="text-align: center; margin-top: 20px"
      ></p>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      const { createApp } = Vue;

      const API_URL = 'https://script.google.com/macros/s/AKfycbyCn7Mu1H3l7Vn21bXxsZfte58lRXXG4aHL7ttPBmm2tSdzIOf96soImawUDGCX-fP3Kw/exec';
      const TOKEN = '';

      // Constantes de datos
      const PLAYERS = [
        { name: 'Balada', img: 'https://res.cloudinary.com/srourera/image/upload/c_thumb,w_200,g_face/v1756546668/minguella/Sin_ti%CC%81tulo_spdzsh.png' },
        { name: 'Rou', img: 'https://res.cloudinary.com/srourera/image/upload/c_thumb,w_200,g_face/v1756546684/minguella/Sergi512x512_ztcb6x.jpg' },
        { name: 'Neymar', img: 'https://via.placeholder.com/80x80/f39c12/ffffff?text=N' },
        { name: 'Mbappé', img: 'https://via.placeholder.com/80x80/9b59b6/ffffff?text=M' },
        { name: 'Haaland', img: 'https://via.placeholder.com/80x80/1abc9c/ffffff?text=H' },
        { name: 'Bellingham', img: 'https://via.placeholder.com/80x80/e67e22/ffffff?text=B' }
      ];

      const FINE = [
        {
          name: 'Retraso',
          amounts: [5, 7.5, 10, 12.5]
        },
        {
          name: 'Falta de asistencia',
          amounts: [10, 15, 20, 25]
        },
        {
          name: 'Comportamiento',
          amounts: [15, 22.5, 30, 37.5]
        },
        {
          name: 'Incumplimiento',
          amounts: [20, 30, 40, 50]
        },
        {
          name: 'Grave',
          amounts: [50, 75, 100, 125]
        }
      ];

      createApp({
        data() {
          return {
            currentStep: 1,
            selectedPlayer: null,
            selectedFineType: null,
            selectedAmount: null,
            comments: "",
            saving: false,
            players: PLAYERS.map((player, index) => ({
              id: index + 1,
              name: player.name,
              photo: player.img
            })),
            fineTypes: FINE.map((fine, index) => ({
              id: index + 1,
              name: fine.name,
              amounts: fine.amounts
            })),
          };
        },
        computed: {
          progress() {
            return (this.currentStep / 4) * 100;
          },
          availableAmounts() {
            if (!this.selectedFineType) return [];
            return this.selectedFineType.amounts;
          },
        },
        methods: {
          selectPlayer(player) {
            this.selectedPlayer = player;
          },
          selectPlayerAndNext(player) {
            this.selectPlayer(player);
            this.nextStep();
          },
          selectFineType(fineType) {
            this.selectedFineType = fineType;
            this.selectedAmount = null; // Reset amount when type changes
          },
          selectFineTypeAndNext(fineType) {
            this.selectFineType(fineType);
            this.nextStep();
          },
          selectAmount(amount) {
            this.selectedAmount = amount;
          },
          selectAmountAndNext(amount) {
            this.selectAmount(amount);
            this.nextStep();
          },
          nextStep() {
            if (this.currentStep < 4) {
              this.currentStep++;
            }
          },
          previousStep() {
            if (this.currentStep > 1) {
              this.currentStep--;
            }
          },
          resetForm() {
            this.currentStep = 1;
            this.selectedPlayer = null;
            this.selectedFineType = null;
            this.selectedAmount = null;
            this.comments = "";
          },
          async createFine(payload) {
            const qs = new URLSearchParams({
                action: 'addLine',
                payload: JSON.stringify(payload)
                // token: TOKEN  // si decides usarlo
            });
            const res = await fetch(`${API_URL}?${qs.toString()}`, { method: 'GET' });
            const json = await res.json();
            if (!json.ok) throw new Error(json.error || 'Error');
            return true;
          },
          async saveFine() {
            this.saving = true;

            // Simular llamada a Google Apps Script
            const payload = {
              player: this.selectedPlayer.name,
              type: this.selectedFineType.name,
              amount: this.selectedAmount,
              comments: this.comments,
            };

            try {
              await this.createFine(payload)
              document.getElementById("msg").textContent =
                "Multa guardada exitosamente ✅";
              this.resetForm();
              setTimeout(() => {
                document.getElementById("msg").textContent = "";
              }, 3000);
            } catch (error) {
              console.error(error);
            } finally {
              this.saving = false;
            }            
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
